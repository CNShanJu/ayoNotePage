## 闭包

es5中没有块级作用域，es6中才有块级作用域  --->   {}

js的变量作用域：全局的作用域、局部作用域

js中函数内部创建的变量为局部的变量，js函数外部创建的变量为全局的变量

`注：函数内部不使用var声明的变量，也被称为全局变量`

```js
var a = 10;
function fun(){
    console.log(a);
    var b = 15;
    c = 45;
}

console.log(c);
```



一个函数和对其周围状态（**lexical environment，词法环境**）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是**闭包**（**closure**）。也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域。在 JavaScript 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来。

### 闭包是什么：

1. 扩展变量的访问域
2. 函数内部可以访问全局的变量，函数外部无法访问局部变量
3. 闭包 = 函数内部的内部函数(一般是匿名函数) + 创建此函数时携带的环境的信息
4. 闭包可以访问自由变量的内部函数(访问函数内部的变量)
5. 当一个作用域中可以访问另外一个作用域的变量时，则发生了闭包

### 闭包有什么作用

1. 通过闭包可以扩展变量的范围：访问内部函数的变量
2. ==变量常驻内存==
3. `立即调用函数`的表达式，在引用外部变量的时候也会形成闭包，并形成独立的作用域防止变量污染

```js
//立即执行函数
(function(){})();
```

### 案例

```HTML
<ul>
	<li>可乐</li>
	<li>可乐1</li>
	<li>可乐2</li>
	<li>可乐3</li>
</ul>

<script>
var ul = document.querySelector("ul");
var allLi = ul.children;
for(var i = 0; i < allLi.length; i++) {
	allLi[i].onclick = function() {
		console.log(i);//无论点击哪个li都会输出4
	}
}
</script>
```

原因：for循环是一个外部闭包，依次绑定的点击事件是一个函数实例，也产生了一个闭包域，它引用了外部闭包的变量i，外部闭包域中i的最终值为4，点击事件触发时引用外部闭包变量i（此时i=4），所以输出的值全为4。

**解决**

方法一：增加若干个对应的闭包域空间(采用匿名函数实现)专门用来存储原先需要引用的内容(下标值)，只限于基本类型(基本类型值传递，对象类型引用传递)

```js
var ul = document.querySelector("ul");
var allLi = ul.children;
for(var i = 0; i < allLi.length; i++) {
	(function(arr) {///这个函数对象有一个本地私有变量arg(形参)，该函数的function scope的closure对象属性有两个引用：arr和i。i的值随外部改变，但是本地的私有变量(形参)arg不会受影响，其值在一开始被调用时就决定了
		allLi[i].onclick = function() {////onclick函数实例的function scope的closure对象属性有一个引用arg
			console.log(arr);//只要外部空间的arg不变，这里的引用值就不会改变
		}
	})(i)//立即执行匿名函数，传递下标i(实参)
}
```

方法二：将下标作为对象属性(name:"i",value:i的值)添加到每个数组项(p对象)中

```js
for(var i=0; i<arr.length; i++){
       //为当前数组项(当前p对象)添加一个名为i的属性，值为循环体i变量的值
       //此时当前p对象的i属性并不是对循环体的i变量的引用，而是一个独立p对象的属性，属性值在声明的时候就确定了
       arr[i].i = i;
       arr[i].onclick = function (){
              alert(this.i);
       }
}
```

方法三：增加若干个对应的闭包域空间用来存储下标。新增的匿名闭包空间内完成事件绑定。

```jsx
//绑定的函数中的function scope中的closure对象的引用arg是指向将其返回的匿名函数的私有变量arg
for(var i = 0; i<arr.length; i++){
      arr[i].onclick = (function(arg){
              return function () {
                     alert(arg);
              }
      })(i);
}
```

方法四：使用ES6的**let**关键字

```jsx
"use strict";//
var arr = document.getElementsByTagName("p");
for(var i = 0; i<arr.length; i++){
      let j = i;//块级变量
      arr[i].onclick = function () {
             alert(j);
      }
}
```

个人推荐后两种方法。

> `"use strict" `指令在 JavaScript 1.8.5 (ECMAScript5) 中新增。它不是一条语句，但是是一个字面量表达式，在 JavaScript 旧版本中会被忽略。"use strict" 的目的是`指定代码在严格条件下执行。严格模式下你不能使用未声明的变量`。
>
> ```js
> "use strict";
> x = 3.14;  
> ```
>
> ```js
> "use strict";
> myFunction();
> function myFunction() {
>    	 y = 3.14;   // 报错 (y 未定义)
> }
> ```
>
> ```js
> x = 3.14;       // 不报错
> myFunction();
> function myFunction() {
>    	"use strict";
>    	 y = 3.14;   // 报错 (y 未定义)
> }
> ```
>

## 正则表达式

[正则表达式简明参考点这](https://www.w3cschool.cn/rxoyts/l17fcozt.html)

作用：查找、验证、匹配、网络爬虫

有高效的特点



### 基本语法

### 两种方法创建方法

1. ```js
   var reg = /匹配规则/   ==>字面量的形式
   ```

2. ```js
   var reg = new Regexp(/匹配规则/)   ==>内置对象
   ```

### 内置方法

|     方法     | 描述                                                         |
| :----------: | :----------------------------------------------------------- |
|   match():   | 使用正则表达式对字符进行查找,并将查找的结果作为`数组`进行返回，如果没有找到则返回`null`； |
| test(string) | 如果字符串 string 中含有与 RegExpObject 匹配的文本，则返回 true，否则返回 false。<br />与这个表示式是等价的：`(r.exec(s) != null)。` |

|   方法    |  所属对象  |         参数         |                        返回值                         |      通用性      |                            特殊性                            |
| :-------: | :--------: | :------------------: | :---------------------------------------------------: | :--------------: | :----------------------------------------------------------: |
|  exec()   | 正则表达式 |        字符串        |      匹配结果的数组。如果没有找到，返回值为 null      |     通用强大     |          一次只能匹配一个单元，并提供详细的返回信息          |
|  test()   | 正则表达式 |        字符串        |                 布尔值，表示是否匹配                  |     快速验证     |     一次只能匹配一个单元，返回信息与 exec() 方法基本相似     |
| search()  |   字符串   |      正则表达式      | 匹配起始位置。如果没有找到任何匹配的字符串，则返回 -1 |   简单字符定位   | 不执行全局匹配，将忽略标志 g，也会忽略正则表达式的 lastIndex 属性 |
|  match()  |   字符串   |      正则表达式      |            匹配的数组，或者匹配信息的数组             | 常用字符匹配方法 |          将根据全局模式的标志 g 决定匹配操作的行为           |
| replace() |   字符串   | 正则表达式或替换文本 |                 返回替换后的新字符串                  |   匹配替换操作   |          可以支持替换函数，同时可以获取更多匹配信息          |
|  split()  |   字符串   | 正则表达式或分割字符 |                       返回数组                        |     特殊用途     |                   把字符串分隔为字符串数组                   |

==注：正则表达式区分大小写==

### 正则表达式的标记符

| 标记符 |                       描述                       |
| :----: | :----------------------------------------------: |
|   i    |                   不区分大小写                   |
|   g    | 全局匹配(意味着匹配成功一个后，会继续往后面执行) |

### 普通的匹配符

| 匹配符 |                             描述                             |
| :----: | :----------------------------------------------------------: |
|   \d   |                          0-9的数字                           |
|   \w   |             字母、数字、下划线都能匹配(空格不行)             |
|   .    |              字母、数字、下划线、空格都可以匹配              |
|        |                注意，以上匹配符只匹配一个字符                |
|   []   | ==自定义规则的匹配符==，<br />例如`[^]`，表示`取反`（注：中括号里的^才表示取反）；<br />`[3,5]`,表示匹配对象出现3或者5<br />`[^123]`表示出现的数字不能有1,2,3 |
|   {}   | 用来修饰==匹配符出现次数==，<br />例如`{n}`，表示前面匹配符出现n次；<br />`{n,m}`，表示前面的匹配符出现n到m次；<br />`{n，}`,表示前面的匹配符出现n到无限大次；<br />`{，n}`，表示前面的匹配符出现0到n次 |
|   +    |               匹配符至少出现一次 ，即1到无限次               |
|   ？   |               出现0到1次，即可以没有，最多一次               |
|   *    |                       出现0到无限大次                        |
|   $    |           完整匹配，匹配词条必须与匹配条件完全一致           |

```js
// /n转成<br/>标签
function nToBr(str) {
   // let reg = new RegExp(/\n/g);
   let reg = /\n/g;
   str_ = str.replace(/\n/g, '<br/>');
   console.log(str_);
},
    
nToBr(`\n这里是\n活动内容示意，这里是活动内容示意`);

//<br/>这里是<br/>活动内容示意，这里是活动内容示意
```



### 常用匹配规则

1.由数字、26个英文字母或者下划线组成的字符串:

```js
^[0-9a-zA-Z_]{1,}$
```

2.非负整数（正整数 + 0 ）:

```js
^/d+$
```

3.正整数:

```js
^[0-9]*[1-9][0-9]*$
```

4.非正整数（负整数 + 0）：

```js
^((-/d+)|(0+))$
```

5.负整数 :

```js
^-[0-9]*[1-9][0-9]*$
```

6.整数:

```js
^-?/d+$
```

7.非负浮点数（正浮点数 + 0）:

```js
^/d+(/./d+)?$
```

8.正浮点数 :

```js
^(([0-9]+/.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*/.[0-9]+)|([0-9]*[1-9][0-9]*))$
```

9.非正浮点数（负浮点数 + 0）:

```js
^((-/d+(/./d+)?)|(0+(/.0+)?))$
```

10.负浮点数 :

```js
^(-(([0-9]+/.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*/.[0-9]+)|([0-9]*[1-9][0-9]*)))$
```

11.浮点数 :

```js
^(-?/d+)(/./d+)?$
```

12.由26个英文字母组成的字符串 :

```js
^[A-Za-z]+$
```

13.由26个英文字母的大写组成的字符串 :

```js
^[A-Z]+$
```

14.由26个英文字母的小写组成的字符串 :

```js
^[a-z]+$
```

15.由26个英文字母的小写组成的字符串 :

```js
^[a-z]+$
```

16.由数字、26个英文字母或者下划线组成的字符串 :

```js
^/w+$
```

17.email地址 :

```js
^[/w-]+(/.[/w-]+)*@[/w-]+(/.[/w-]+)+$
```

18.url:

```js
^[a-zA-z]+://(/w+(-/w+)*)(/.(/w+(-/w+)*))*(/?/S*)?$
```

19.年-月-日:

```js
/^(d{2}|d{4})-((0([1-9]{1}))|(1[1|2]))-(([0-2]([1-9]{1}))|(3[0|1]))$/
```

20.月/日/年:

```js
/^((0([1-9]{1}))|(1[1|2]))/(([0-2]([1-9]{1}))|(3[0|1]))/(d{2}|d{4})$/
```

21.Emil:

```js
^([w-.]+)@(([[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.)|(([w-]+.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(]?)$
```

22.电话号码:

```js
(d+-)?(d{4}-?d{7}|d{3}-?d{8}|^d{7,8})(-d+)?
```

23.IP地址:

```js
^(d{1,2}|1dd|2[0-4]d|25[0-5]).(d{1,2}|1dd|2[0-4]d|25[0-5]).(d{1,2}|1dd|2[0-4]d|25[0-5]).(d{1,2}|1dd|2[0-4]d|25[0-5])$
```

24.匹配中文字符的[正则表达式](https://so.csdn.net/so/search?q=正则表达式)：

```js
[/u4e00-/u9fa5]
```

25.匹配双字节字符(包括汉字在内)：

```js
[^/x00-/xff]
```

25.匹配双字节字符(包括汉字在内)：

```js
[^/x00-/xff]
```

27.匹配HTML标记的正则表达式：

```js
/<(.*)>.*<///1>|<(.*) //>/
```

28.匹配首尾空格的正则表达式：

```js
(^/s*)|(/s*$)
```

29.匹配Email地址的正则表达式：

```js
/w+([-+.]/w+)*@/w+([-.]/w+)*/./w+([-.]/w+)*
```

30.匹配网址URL的正则表达式：

```js
^[a-zA-z]+://(//w+(-//w+)*)(//.(//w+(-//w+)*))*(//?//S*)?$
```

31.匹配帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：

```js
^[a-zA-Z][a-zA-Z0-9_]{4,15}$
```

32.匹配国内电话号码：

```js
(/d{3}-|/d{4}-)?(/d{8}|/d{7})?
```

33.匹配腾讯QQ号：

```js
^[1-9]*[1-9][0-9]*$
```

34.只能输入数字：

```js
^[0-9]*$
```

35.只能输入n位的数字：

```js
^/d{n}$
```

36.只能输入至少n位的数字：

```js
^/d{n,}$
```

37.只能输入m~n位的数字：

```js
^/d{m,n}$
```

38.只能输入零和非零开头的数字：

```js
^(0|[1-9][0-9]*)$
```

39.只能输入有两位小数的正实数：

```js
^[0-9]+(.[0-9]{2})?$
```

40.只能输入有1~3位小数的正实数：

```js
^[0-9]+(.[0-9]{1,3})?$
```

41.只能输入非零的正整数：

```js
^/+?[1-9][0-9]*$
```

42.只能输入非零的负整数：

```js
^/-[1-9][0-9]*$
```

43.只能输入长度为3的字符：

```js
^.{3}$
```

44.只能输入由26个英文字母组成的字符串：

```js
^[A-Za-z]+$
```

45.只能输入由26个大写英文字母组成的字符串：

```js
^[A-Z]+$
```

46.只能输入由26个小写英文字母组成的字符串：

```js
^[a-z]+$
```

47.只能输入由数字和26个英文字母组成的字符串：

```js
^[A-Za-z0-9]+$
```

48.只能输入由数字和26个英文字母或者下划线组成的字符串：

```js
^/w+$
```

49.验证用户密码(正确格式为： 以字母开头，长度在5~17 之间，只能包含字符、数字和下划线)

```js
^[a-zA-Z]/w{5,17}$
```

50.验证是否包含有 ^%&’,;=?$/"等字符：

```js
[^%&',;=?$/x22]+
```

51.只能输入汉字：

```js
^[\u4e00-\u9fa5]{0,}$
```

52、只含有汉字、数字、字母、下划线不能以下划线开头和结尾

```js
^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$
```

53、只含有汉字、数字、字母、下划线，下划线位置不限

```js
^[a-zA-Z0-9_\u4e00-\u9fa5]+$
```

54、2~4个汉字

```js
@"^[\u4E00-\u9FA5]{2,4}$
```



### 总结

**常用元字符**

| 代码 | 说明                       |
| :--- | :------------------------- |
| .    | 匹配除换行符以外的任意字符 |
| \w   | 匹配字母或数字或下划线     |
| \s   | 匹配任意的空白符           |
| \d   | 匹配数字                   |
| \b   | 匹配单词的开始或结束       |
| ^    | 匹配字符串的开始           |
| $    | 匹配字符串的结束           |
| -    | 表示范围                   |
| []   | 匹配括号中的任意一个字符   |

**常用限定符**

| 代码/语法 | 说明             |
| :-------- | :--------------- |
| *         | 重复零次或更多次 |
| +         | 重复一次或更多次 |
| ?         | 重复零次或一次   |
| {n}       | 重复n次          |
| {n,}      | 重复n次或更多次  |
| {n,m}     | 重复n到m次       |

**常用反义词**

| 代码/语法 | 说明                                       |
| :-------- | :----------------------------------------- |
| \W        | 匹配任意不是字母，数字，下划线，汉字的字符 |
| \S        | 匹配任意不是空白符的字符                   |
| \D        | 匹配任意非数字的字符                       |
| \B        | 匹配不是单词开头或结束的位置               |
| [^x]      | 匹配除了x以外的任意字符                    |
| [^aeiou]  | 匹配除了aeiou这几个字母以外的任意字符      |
